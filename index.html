<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image to PDF Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body class="bg-slate-50 dark:bg-slate-900">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
        import React, { useState, useCallback, useRef } from 'react';
        import ReactDOM from 'react-dom/client';

        const ArrowDownIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3" />
            </svg>
        );

        const ArrowUpIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
            </svg>
        );

        const DownloadIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
            </svg>
        );

        const FileIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
            </svg>
        );

        const GenerateIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M4.5 12a7.5 7.5 0 0 0 15 0m-15 0a7.5 7.5 0 1 1 15 0m-15 0H3m18 0h-1.5m-15 0a7.5 7.5 0 1 1 15 0m-15 0H3m15 0h1.5m-1.5-3.75l.75-1.3m-12 5.05.75-1.3m10.5 0-.75-1.3m-9.75 0-.75-1.3M12 6.75v-1.5m0 15v-1.5" />
            </svg>
        );

        const ShareIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.195.025.39.044.588.05H11.25m-3.468 2.136a2.25 2.25 0 0 1 0-2.186m0 2.186c.195-.025.39-.044.588-.05H11.25m6.75 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-4.5 0v-2.186c0-.621.504-1.125 1.125-1.125h1.125c.621 0 1.125.504 1.125 1.125v2.186m-6.75 0v-2.186c0-.621.504-1.125 1.125-1.125h1.125c.621 0 1.125.504 1.125 1.125v2.186" />
            </svg>
        );

        const TrashIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
                <path strokeLinecap="round" strokeLinejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.067-2.09.92-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
            </svg>
        );
        
        const UploadIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" />
            </svg>
        );

        const Spinner = () => {
            return (
                <svg className="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            );
        };

        const LoadingModal = ({ message }) => {
            return (
                <div className="fixed inset-0 bg-black bg-opacity-75 flex flex-col items-center justify-center z-50 backdrop-blur-sm">
                    <Spinner />
                    <p className="text-white text-lg mt-4 font-semibold">{message || "Processing..."}</p>
                </div>
            );
        };

        const Header = () => {
            return (
                <header className="bg-white dark:bg-slate-800/50 shadow-md backdrop-blur-sm sticky top-0 z-10">
                    <div className="container mx-auto px-4 md:px-8 py-4 flex items-center gap-4">
                        <FileIcon className="h-8 w-8 text-indigo-500" />
                        <h1 className="text-2xl font-bold text-slate-900 dark:text-white">
                            Image to PDF Converter
                        </h1>
                    </div>
                </header>
            );
        };

        const Footer = () => {
            return (
                <footer className="bg-white dark:bg-slate-800/50 mt-8">
                    <div className="container mx-auto px-4 md:px-8 py-4 text-center text-slate-500 dark:text-slate-400">
                        <p>&copy; {new Date().getFullYear()} Image to PDF Converter. All rights reserved. Works offline.</p>
                    </div>
                </footer>
            );
        };

        const ImageSelector = ({ onFilesSelected }) => {
            const fileInputRef = useRef(null);

            const handleFileChange = (event) => {
                if (event.target.files) {
                    onFilesSelected(event.target.files);
                }
            };

            const handleClick = () => {
                fileInputRef.current?.click();
            };

            return (
                <section className="bg-white dark:bg-slate-800 p-6 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 mb-8 text-center">
                    <h2 className="text-xl font-semibold mb-4 text-slate-800 dark:text-slate-100">Step 1: Select Your Images</h2>
                    <p className="text-slate-600 dark:text-slate-400 mb-6">Click the button below to choose multiple images from your device. Your files are processed locally and are never uploaded.</p>
                    <input
                        type="file"
                        multiple
                        accept="image/*"
                        onChange={handleFileChange}
                        ref={fileInputRef}
                        className="hidden"
                    />
                    <button
                        onClick={handleClick}
                        className="inline-flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-slate-50 dark:focus:ring-offset-slate-900 transition-colors"
                    >
                        <UploadIcon className="w-5 h-5" />
                        <span>Select Images</span>
                    </button>
                </section>
            );
        };

        const ImageList = ({ images, onReorder, onRemove }) => {
            return (
                <section className="bg-white dark:bg-slate-800 p-6 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 mb-8">
                    <h2 className="text-xl font-semibold mb-4 text-slate-800 dark:text-slate-100">Step 2: Arrange Your Images</h2>
                    <p className="text-slate-600 dark:text-slate-400 mb-6">Images will appear in the PDF in the order shown below. Use the arrows to reorder them or the trash icon to remove an image.</p>
                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                        {images.map((image, index) => (
                            <div key={image.id} className="relative group border-2 border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden aspect-square">
                                <img src={image.previewUrl} alt={image.file.name} className="w-full h-full object-cover" />
                                <div className="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 transition-all duration-300 flex flex-col items-center justify-center p-2">
                                    <div className="opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center gap-2">
                                        <button
                                            onClick={() => onReorder(index, index - 1)}
                                            disabled={index === 0}
                                            className="p-2 bg-white/80 rounded-full text-slate-800 hover:bg-white disabled:opacity-30 disabled:cursor-not-allowed"
                                            title="Move Up"
                                        >
                                            <ArrowUpIcon className="w-5 h-5" />
                                        </button>
                                        <button
                                            onClick={() => onRemove(image.id)}
                                            className="p-2 bg-red-500/80 rounded-full text-white hover:bg-red-500"
                                            title="Remove"
                                        >
                                            <TrashIcon className="w-5 h-5" />
                                        </button>
                                        <button
                                            onClick={() => onReorder(index, index + 1)}
                                            disabled={index === images.length - 1}
                                            className="p-2 bg-white/80 rounded-full text-slate-800 hover:bg-white disabled:opacity-30 disabled:cursor-not-allowed"
                                            title="Move Down"
                                        >
                                            <ArrowDownIcon className="w-5 h-5" />
                                        </button>
                                    </div>
                                    <p className="text-white text-xs font-mono mt-2 truncate opacity-0 group-hover:opacity-100 transition-opacity duration-300 w-full text-center" title={image.file.name}>
                                        {index + 1}. {image.file.name}
                                    </p>
                                </div>
                            </div>
                        ))}
                    </div>
                </section>
            );
        };

        const PdfActions = ({ onGenerate, pdfFile, onShare, isGenerating, hasImages }) => {
            const canShare = !!(navigator.share && navigator.canShare);

            return (
                <section className="bg-white dark:bg-slate-800 p-6 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700">
                    <h2 className="text-xl font-semibold mb-4 text-slate-800 dark:text-slate-100">Step 3: Create & Export PDF</h2>
                    <p className="text-slate-600 dark:text-slate-400 mb-6">Once you are happy with the image order, generate the PDF. You can then download it or share it directly if your browser supports it.</p>
                    <div className="flex flex-wrap items-center gap-4">
                        <button
                            onClick={onGenerate}
                            disabled={isGenerating || !hasImages}
                            className="inline-flex items-center gap-2 px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-slate-50 dark:focus:ring-offset-slate-900 transition-colors disabled:bg-slate-400 disabled:cursor-not-allowed"
                        >
                            {isGenerating ? <Spinner /> : <GenerateIcon className="w-5 h-5" />}
                            <span>{isGenerating ? 'Generating...' : 'Generate PDF'}</span>
                        </button>
                        {pdfFile && (
                            <>
                                <a
                                    href={pdfFile.url}
                                    download={pdfFile.name}
                                    className="inline-flex items-center gap-2 px-6 py-3 bg-sky-600 text-white font-semibold rounded-lg shadow-md hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 focus:ring-offset-slate-50 dark:focus:ring-offset-slate-900 transition-colors"
                                >
                                    <DownloadIcon className="w-5 h-5" />
                                    <span>Download PDF</span>
                                </a>
                                {canShare && (
                                    <button
                                        onClick={onShare}
                                        className="inline-flex items-center gap-2 px-6 py-3 bg-purple-600 text-white font-semibold rounded-lg shadow-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-slate-50 dark:focus:ring-offset-slate-900 transition-colors"
                                    >
                                        <ShareIcon className="w-5 h-5" />
                                        <span>Share</span>
                                    </button>
                                )}
                            </>
                        )}
                    </div>
                </section>
            );
        };
        
        const App = () => {
            const [images, setImages] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [loadingMessage, setLoadingMessage] = useState('');
            const [pdfFile, setPdfFile] = useState(null);

            const handleFilesSelected = (files) => {
                const newImages = Array.from(files)
                    .filter(file => file.type.startsWith('image/'))
                    .map(file => ({
                        id: `${file.name}-${file.lastModified}-${Math.random()}`,
                        file: file,
                        previewUrl: URL.createObjectURL(file),
                    }));
                setImages(prevImages => [...prevImages, ...newImages]);
                setPdfFile(null);
            };

            const reorderImages = (sourceIndex, destinationIndex) => {
                setImages(prevImages => {
                    const newImages = [...prevImages];
                    const [removed] = newImages.splice(sourceIndex, 1);
                    newImages.splice(destinationIndex, 0, removed);
                    return newImages;
                });
            };

            const removeImage = (id) => {
                setImages(prevImages => prevImages.filter(image => image.id !== id));
            };

            const generatePdf = useCallback(async () => {
                if (images.length === 0) {
                    alert("Please select some images first.");
                    return;
                }

                setIsLoading(true);
                setLoadingMessage('Initializing PDF document...');

                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();

                    for (let i = 0; i < images.length; i++) {
                        const image = images[i];
                        setLoadingMessage(`Processing image ${i + 1} of ${images.length}...`);

                        if (i > 0) {
                            doc.addPage();
                        }

                        const img = new Image();
                        img.src = image.previewUrl;

                        await new Promise((resolve, reject) => {
                            img.onload = resolve;
                            img.onerror = (err) => {
                                console.error(`Failed to load image: ${image.file.name}`, err);
                                reject(new Error(`Could not load image ${image.file.name} for PDF generation.`));
                            };
                        });

                        const pageWidth = doc.internal.pageSize.getWidth();
                        const pageHeight = doc.internal.pageSize.getHeight();
                        const aspectRatio = img.width / img.height;
                        const pageAspectRatio = pageWidth / pageHeight;

                        let finalWidth, finalHeight;
                        if (aspectRatio > pageAspectRatio) {
                            finalWidth = pageWidth;
                            finalHeight = pageWidth / aspectRatio;
                        } else {
                            finalHeight = pageHeight;
                            finalWidth = pageHeight * aspectRatio;
                        }

                        const x = (pageWidth - finalWidth) / 2;
                        const y = (pageHeight - finalHeight) / 2;
                        doc.addImage(img, 'JPEG', x, y, finalWidth, finalHeight);
                    }

                    setLoadingMessage('Finalizing PDF...');
                    const pdfBlob = doc.output('blob');
                    const pdfUrl = URL.createObjectURL(pdfBlob);
                    const fileName = `converted-${new Date().toISOString().split('T')[0]}.pdf`;
                    setPdfFile({ url: pdfUrl, name: fileName, blob: pdfBlob });
                } catch (error) {
                    console.error('Failed to generate PDF:', error);
                    alert(`An error occurred while generating the PDF: ${error instanceof Error ? error.message : 'Unknown error'}`);
                } finally {
                    setIsLoading(false);
                    setLoadingMessage('');
                }
            }, [images]);
            
            const handleShare = async () => {
                if (!pdfFile || !navigator.share) return;
                
                const fileToShare = new File([pdfFile.blob], pdfFile.name, { type: 'application/pdf' });

                if (navigator.canShare && navigator.canShare({ files: [fileToShare] })) {
                    try {
                        await navigator.share({
                            files: [fileToShare],
                            title: 'My PDF Document',
                            text: 'Here is the PDF I created.',
                        });
                    } catch (error) {
                        console.error('Error sharing:', error);
                        alert("Sharing failed. You can still download the file.");
                    }
                } else {
                    alert("Your browser doesn't support sharing files. Please download the PDF instead.");
                }
            };


            return (
                <div className="min-h-screen flex flex-col text-slate-800 dark:text-slate-200">
                    <Header />
                    <main className="flex-grow container mx-auto p-4 md:p-8">
                        <div className="max-w-4xl mx-auto">
                            <ImageSelector onFilesSelected={handleFilesSelected} />
                            
                            {images.length > 0 && (
                                <>
                                    <ImageList 
                                        images={images} 
                                        onReorder={reorderImages} 
                                        onRemove={removeImage} 
                                    />
                                    <PdfActions 
                                        onGenerate={generatePdf}
                                        pdfFile={pdfFile}
                                        onShare={handleShare}
                                        isGenerating={isLoading}
                                        hasImages={images.length > 0}
                                    />
                                </>
                            )}
                        </div>
                    </main>
                    <Footer />
                    {isLoading && <LoadingModal message={loadingMessage} />}
                </div>
            );
        };

        const rootElement = document.getElementById('root');
        if (!rootElement) {
          throw new Error("Could not find root element to mount to");
        }

        const root = ReactDOM.createRoot(rootElement);
        root.render(
          <React.StrictMode>
            <App />
          </React.StrictMode>
        );
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>